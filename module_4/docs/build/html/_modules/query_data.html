<!DOCTYPE html>

<html lang="English" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>query_data &#8212; GradCafe Analytics 1.3 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <script src="../_static/documentation_options.js?v=b7e9ff8f"></script>
    <script src="../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for query_data</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">query_data.py</span>

<span class="sd">Module 3/4 - Querying PostgreSQL (GradCafe dataset)</span>

<span class="sd">This module supports two use cases:</span>

<span class="sd">1) CLI reporting (Module 3):</span>
<span class="sd">   - Connects to PostgreSQL via DATABASE_URL</span>
<span class="sd">   - Runs the required SQL analytics queries</span>
<span class="sd">   - Prints results in a screenshot-friendly format</span>

<span class="sd">2) Testability support (Module 4):</span>
<span class="sd">   - Exposes `query_applicants_as_dicts()` which returns rows as dictionaries</span>
<span class="sd">     with stable keys used by templates/tests.</span>

<span class="sd">How to run (CLI):</span>
<span class="sd">-----------------</span>
<span class="sd">export DATABASE_URL=&quot;postgresql://graduser:grad123@localhost:5432/gradcafe&quot;</span>
<span class="sd">python3 query_data.py</span>

<span class="sd">Design Notes:</span>
<span class="sd">-------------</span>
<span class="sd">- Uses psycopg for PostgreSQL connectivity.</span>
<span class="sd">- Uses defensive formatting for Decimal outputs (common for numeric SQL types).</span>
<span class="sd">- Keeps query printing logic in `run_query()` so each question stays readable.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">decimal</span><span class="w"> </span><span class="kn">import</span> <span class="n">Decimal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Optional</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">psycopg</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># --- Path setup: allow autodoc to import modules from /src ---</span>
<span class="n">ROOT</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>   <span class="c1"># module_4/</span>
<span class="n">SRC</span> <span class="o">=</span> <span class="n">ROOT</span> <span class="o">/</span> <span class="s2">&quot;src&quot;</span>                          <span class="c1"># module_4/src</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">SRC</span><span class="p">))</span>


<span class="c1"># ============================================================================</span>
<span class="c1"># Connection Management</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Centralizes DATABASE_URL handling so both CLI runs and tests fail early with a</span>
<span class="c1"># clear message if configuration is missing.</span>
<span class="c1"># ============================================================================</span>

<div class="viewcode-block" id="get_connection">
<a class="viewcode-back" href="../api.html#query_data.get_connection">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_connection</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create and return a psycopg connection using DATABASE_URL.</span>

<span class="sd">    Returns:</span>
<span class="sd">        psycopg.Connection: An open database connection.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If DATABASE_URL environment variable is not set.</span>

<span class="sd">    Why:</span>
<span class="sd">        Using DATABASE_URL keeps configuration portable across:</span>
<span class="sd">        - local dev</span>
<span class="sd">        - GitHub Actions CI</span>
<span class="sd">        - Read the Docs / documentation examples</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">db_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DATABASE_URL&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">db_url</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;DATABASE_URL environment variable is not set.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Example:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s1">&#39;export DATABASE_URL=&quot;postgresql://graduser:grad123@localhost:5432/gradcafe&quot;&#39;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_url</span><span class="p">)</span></div>



<span class="c1"># ============================================================================</span>
<span class="c1"># Output normalization helpers</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># PostgreSQL numeric columns often arrive as Decimal objects. Converting to float</span>
<span class="c1"># makes console output (and sometimes serialization) cleaner and consistent.</span>
<span class="c1"># ============================================================================</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_clean_value</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert Decimal values to float for cleaner output.</span>

<span class="sd">    Args:</span>
<span class="sd">        value: Any value returned from PostgreSQL.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float if value is Decimal; otherwise returns original value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>


<span class="c1"># ============================================================================</span>
<span class="c1"># Query runner (CLI formatting)</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Prints results in a screenshot-style format similar to assignment examples.</span>
<span class="c1"># Supports:</span>
<span class="c1"># - single scalar outputs (COUNT, AVG, etc.)</span>
<span class="c1"># - multi-column single-row outputs (e.g., 4 averages)</span>
<span class="c1"># - multi-row outputs (e.g., top programs table)</span>
<span class="c1"># ============================================================================</span>

<div class="viewcode-block" id="run_query">
<a class="viewcode-back" href="../api.html#query_data.run_query">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">run_query</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">sql</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">multi_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Execute SQL query and print results in a screenshot-style output.</span>

<span class="sd">    Args:</span>
<span class="sd">        cursor: psycopg cursor object.</span>
<span class="sd">        title: Human-readable title for the query (kept for readability).</span>
<span class="sd">        sql: SQL query string.</span>
<span class="sd">        multi: True if the query returns multiple rows.</span>
<span class="sd">        label: Label for single-value outputs (e.g., &quot;Applicant count&quot;).</span>
<span class="sd">        multi_labels: Labels for multi-column single-row outputs (e.g., averages).</span>

<span class="sd">    Notes:</span>
<span class="sd">        - This function prints to console (for Module 3 screenshots).</span>
<span class="sd">        - Web UI rendering is handled separately by Flask routes/templates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>

    <span class="c1"># -------------------- Multi-row results --------------------</span>
    <span class="c1"># Used for queries like &quot;Top 5 programs&quot; where multiple rows are expected.</span>
    <span class="k">if</span> <span class="n">multi</span><span class="p">:</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>  <span class="c1"># spacing line for readability</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="n">cleaned</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
                <span class="n">cleaned</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_clean_value</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">cleaned</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># -------------------- Single-row results --------------------</span>
    <span class="c1"># Most analytics queries return exactly one row.</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No results&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">cleaned</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
        <span class="n">cleaned</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_clean_value</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

    <span class="c1"># -------------------- Scalar output --------------------</span>
    <span class="c1"># Example: COUNT(*), AVG(gpa), percent calculations, etc.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">cleaned</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># -------------------- Multi-value output --------------------</span>
    <span class="c1"># Example: averages for GPA, GRE, GRE V, GRE AW in one row.</span>
    <span class="k">if</span> <span class="n">multi_labels</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">multi_labels</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleaned</span><span class="p">):</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lab</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">multi_labels</span><span class="p">,</span> <span class="n">cleaned</span><span class="p">):</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lab</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">cleaned</span><span class="p">)</span></div>



<span class="c1"># ============================================================================</span>
<span class="c1"># Testability helper (Module 4)</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Returns DB rows as dictionaries with stable keys.</span>
<span class="c1"># This is used by tests to verify schema/data correctness without parsing HTML.</span>
<span class="c1"># ============================================================================</span>

<div class="viewcode-block" id="query_applicants_as_dicts">
<a class="viewcode-back" href="../api.html#query_data.query_applicants_as_dicts">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">query_applicants_as_dicts</span><span class="p">(</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">fetch_all_fn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">list</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return applicants as a list of dicts using the required schema keys.</span>

<span class="sd">    This function exists primarily for Module 4 testing, where tests need to:</span>
<span class="sd">    - verify inserted rows exist</span>
<span class="sd">    - validate required columns are present</span>
<span class="sd">    - validate uniqueness/idempotency behavior</span>

<span class="sd">    Args:</span>
<span class="sd">        limit: Maximum number of rows to return (default: 10).</span>
<span class="sd">        fetch_all_fn: Optional injected dependency for fetching rows.</span>
<span class="sd">                      If None, defaults to app.db.fetch_all.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[dict[str, Any]]: List of dict rows with stable keys.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">fetch_all_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Local import avoids circular dependencies when app imports query layer.</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">app.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">fetch_all</span> <span class="k">as</span> <span class="n">fetch_all_fn</span>

    <span class="c1"># LIMIT is cast to int to avoid accidental SQL injection through non-int inputs.</span>
    <span class="n">sql</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT</span>
<span class="s2">        url, term, status, us_or_international, gpa, gre, gre_v, gre_aw,</span>
<span class="s2">        degree, program, llm_generated_program, llm_generated_university</span>
<span class="s2">    FROM applicants</span>
<span class="s2">    ORDER BY url ASC</span>
<span class="s2">    LIMIT </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span><span class="si">}</span><span class="s2">;</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">fetch_all_fn</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>

    <span class="c1"># Keys match the SELECT order and represent required fields for the app/tests.</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="s2">&quot;term&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;us_or_international&quot;</span><span class="p">,</span> <span class="s2">&quot;gpa&quot;</span><span class="p">,</span> <span class="s2">&quot;gre&quot;</span><span class="p">,</span> <span class="s2">&quot;gre_v&quot;</span><span class="p">,</span> <span class="s2">&quot;gre_aw&quot;</span><span class="p">,</span>
        <span class="s2">&quot;degree&quot;</span><span class="p">,</span> <span class="s2">&quot;program&quot;</span><span class="p">,</span> <span class="s2">&quot;llm_generated_program&quot;</span><span class="p">,</span> <span class="s2">&quot;llm_generated_university&quot;</span>
    <span class="p">]</span>

    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
        <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">r</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">out</span></div>



<span class="c1"># ============================================================================</span>
<span class="c1"># CLI Entry Point (Module 3 reporting)</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Runs all required queries and prints answers.</span>
<span class="c1"># Used for screenshots or sanity-checking DB state.</span>
<span class="c1"># ============================================================================</span>

<div class="viewcode-block" id="main">
<a class="viewcode-back" href="../api.html#query_data.main">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run the required Module 3 SQL analytics queries and print results.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - Output is console-based (for assignment screenshots).</span>
<span class="sd">        - The Flask web UI performs similar queries but renders via templates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">get_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>

            <span class="c1"># ----------------------------------------------------------</span>
            <span class="c1"># Q1: Count Fall 2026 applicants</span>
            <span class="c1"># ----------------------------------------------------------</span>
            <span class="n">run_query</span><span class="p">(</span>
                <span class="n">cursor</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Q1: Number of Fall 2026 applicants&quot;</span><span class="p">,</span>
                <span class="n">sql</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    SELECT COUNT(*)</span>
<span class="s2">                    FROM applicants</span>
<span class="s2">                    WHERE term = &#39;Fall 2026&#39;;</span>
<span class="s2">                    &quot;&quot;&quot;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Applicant count&quot;</span>
            <span class="p">)</span>

            <span class="c1"># ----------------------------------------------------------</span>
            <span class="c1"># Q2: Percent international applicants</span>
            <span class="c1"># NULLIF prevents divide-by-zero when DB is empty.</span>
            <span class="c1"># ----------------------------------------------------------</span>
            <span class="n">run_query</span><span class="p">(</span>
                <span class="n">cursor</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Q2: Percentage of International Applicants&quot;</span><span class="p">,</span>
                <span class="n">sql</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                SELECT</span>
<span class="s2">                  ROUND(</span>
<span class="s2">                    100.0 * SUM(CASE WHEN us_or_international = &#39;International&#39; THEN 1 ELSE 0 END)</span>
<span class="s2">                    / NULLIF(COUNT(*), 0),</span>
<span class="s2">                    2</span>
<span class="s2">                  )</span>
<span class="s2">                FROM applicants</span>
<span class="s2">                WHERE us_or_international IS NOT NULL;</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Percent International&quot;</span>
            <span class="p">)</span>

            <span class="c1"># ----------------------------------------------------------</span>
            <span class="c1"># Q3: Average GPA/GRE metrics</span>
            <span class="c1"># Printed as labeled values for screenshot clarity.</span>
            <span class="c1"># ----------------------------------------------------------</span>
            <span class="n">run_query</span><span class="p">(</span>
                <span class="n">cursor</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Q3: Average GPA, GRE, GRE V, GRE AW&quot;</span><span class="p">,</span>
                <span class="n">sql</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                SELECT</span>
<span class="s2">                  ROUND(AVG(gpa)::numeric, 3),</span>
<span class="s2">                  ROUND(AVG(gre)::numeric, 3),</span>
<span class="s2">                  ROUND(AVG(gre_v)::numeric, 3),</span>
<span class="s2">                  ROUND(AVG(gre_aw)::numeric, 3)</span>
<span class="s2">                FROM applicants;</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">,</span>
                <span class="n">multi_labels</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;Average GPA&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Average GRE&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Average GRE V&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Average GRE AW&quot;</span>
                <span class="p">]</span>
            <span class="p">)</span>

            <span class="c1"># ----------------------------------------------------------</span>
            <span class="c1"># Q4: Avg GPA of American students (Fall 2026)</span>
            <span class="c1"># ----------------------------------------------------------</span>
            <span class="n">run_query</span><span class="p">(</span>
                <span class="n">cursor</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Q4: Avg GPA of American Students (Fall 2026)&quot;</span><span class="p">,</span>
                <span class="n">sql</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                SELECT ROUND(AVG(gpa)::numeric, 3)</span>
<span class="s2">                FROM applicants</span>
<span class="s2">                WHERE term = &#39;Fall 2026&#39;</span>
<span class="s2">                  AND us_or_international = &#39;American&#39;</span>
<span class="s2">                  AND gpa IS NOT NULL;</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Average GPA American&quot;</span>
            <span class="p">)</span>

            <span class="c1"># ----------------------------------------------------------</span>
            <span class="c1"># Q5: Acceptance % for Fall 2025</span>
            <span class="c1"># ----------------------------------------------------------</span>
            <span class="n">run_query</span><span class="p">(</span>
                <span class="n">cursor</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Q5: Acceptance </span><span class="si">% F</span><span class="s2">all 2025&quot;</span><span class="p">,</span>
                <span class="n">sql</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                SELECT</span>
<span class="s2">                  ROUND(</span>
<span class="s2">                    100.0 * SUM(CASE WHEN status = &#39;Accepted&#39; THEN 1 ELSE 0 END)</span>
<span class="s2">                    / NULLIF(COUNT(*), 0),</span>
<span class="s2">                    2</span>
<span class="s2">                  )</span>
<span class="s2">                FROM applicants</span>
<span class="s2">                WHERE term = &#39;Fall 2025&#39;;</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Acceptance percent&quot;</span>
            <span class="p">)</span>

            <span class="c1"># ----------------------------------------------------------</span>
            <span class="c1"># Q6: Avg GPA of accepted applicants (Fall 2026)</span>
            <span class="c1"># ----------------------------------------------------------</span>
            <span class="n">run_query</span><span class="p">(</span>
                <span class="n">cursor</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Q6: Avg GPA of Accepted Applicants (Fall 2026)&quot;</span><span class="p">,</span>
                <span class="n">sql</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                SELECT ROUND(AVG(gpa)::numeric, 3)</span>
<span class="s2">                FROM applicants</span>
<span class="s2">                WHERE term = &#39;Fall 2026&#39;</span>
<span class="s2">                  AND status = &#39;Accepted&#39;</span>
<span class="s2">                  AND gpa IS NOT NULL;</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Average GPA Acceptance&quot;</span>
            <span class="p">)</span>

            <span class="c1"># ----------------------------------------------------------</span>
            <span class="c1"># Q7: JHU Masters CS applicants (LLM standardized fields)</span>
            <span class="c1"># ----------------------------------------------------------</span>
            <span class="n">run_query</span><span class="p">(</span>
                <span class="n">cursor</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Q7: JHU Masters Computer Science Applicants&quot;</span><span class="p">,</span>
                <span class="n">sql</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                SELECT COUNT(*)</span>
<span class="s2">                FROM applicants</span>
<span class="s2">                WHERE degree ILIKE &#39;Master%&#39;</span>
<span class="s2">                  AND llm_generated_program ILIKE &#39;</span><span class="si">%c</span><span class="s2">omputer science%&#39;</span>
<span class="s2">                  AND (</span>
<span class="s2">                        llm_generated_university ILIKE &#39;%Johns Hopkins%&#39;</span>
<span class="s2">                     OR llm_generated_university ILIKE &#39;%JHU%&#39;</span>
<span class="s2">                     OR llm_generated_university ILIKE &#39;%John%Hopkins%&#39;</span>
<span class="s2">                  );</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;JHU Masters Computer Science count&quot;</span>
            <span class="p">)</span>

            <span class="c1"># ----------------------------------------------------------</span>
            <span class="c1"># Q8: Accepted PhD CS applicants in 2026 at top universities</span>
            <span class="c1"># ----------------------------------------------------------</span>
            <span class="n">run_query</span><span class="p">(</span>
                <span class="n">cursor</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Q8: 2026 Accepted PhD CS Applicants at Top Universities&quot;</span><span class="p">,</span>
                <span class="n">sql</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                SELECT COUNT(*)</span>
<span class="s2">                FROM applicants</span>
<span class="s2">                WHERE term ILIKE &#39;</span><span class="si">%2026%</span><span class="s2">&#39;</span>
<span class="s2">                  AND status = &#39;Accepted&#39;</span>
<span class="s2">                  AND degree ILIKE &#39;PhD%&#39;</span>
<span class="s2">                  AND llm_generated_program ILIKE &#39;</span><span class="si">%c</span><span class="s2">omputer science%&#39;</span>
<span class="s2">                  AND (</span>
<span class="s2">                        llm_generated_university ILIKE &#39;</span><span class="si">%G</span><span class="s2">eorgetown%&#39;</span>
<span class="s2">                     OR llm_generated_university ILIKE &#39;%MIT%&#39;</span>
<span class="s2">                     OR llm_generated_university ILIKE &#39;%Massachusetts Institute of Technology%&#39;</span>
<span class="s2">                     OR llm_generated_university ILIKE &#39;%Stanford%&#39;</span>
<span class="s2">                     OR llm_generated_university ILIKE &#39;%Carnegie Mellon%&#39;</span>
<span class="s2">                     OR llm_generated_university ILIKE &#39;%CMU%&#39;</span>
<span class="s2">                  );</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Accepted PhD CS count&quot;</span>
            <span class="p">)</span>

            <span class="c1"># ----------------------------------------------------------</span>
            <span class="c1"># Q9: Same query using raw downloaded fields (not LLM fields)</span>
            <span class="c1"># ----------------------------------------------------------</span>
            <span class="n">run_query</span><span class="p">(</span>
                <span class="n">cursor</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Q9: Same as Q8 Using Raw Downloaded Fields&quot;</span><span class="p">,</span>
                <span class="n">sql</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                SELECT COUNT(*)</span>
<span class="s2">                FROM applicants</span>
<span class="s2">                WHERE term ILIKE &#39;</span><span class="si">%2026%</span><span class="s2">&#39;</span>
<span class="s2">                  AND status = &#39;Accepted&#39;</span>
<span class="s2">                  AND degree ILIKE &#39;PhD%&#39;</span>
<span class="s2">                  AND program ILIKE &#39;</span><span class="si">%c</span><span class="s2">omputer science%&#39;</span>
<span class="s2">                  AND (</span>
<span class="s2">                        program ILIKE &#39;</span><span class="si">%G</span><span class="s2">eorgetown%&#39;</span>
<span class="s2">                     OR program ILIKE &#39;%MIT%&#39;</span>
<span class="s2">                     OR program ILIKE &#39;%Massachusetts Institute of Technology%&#39;</span>
<span class="s2">                     OR program ILIKE &#39;%Stanford%&#39;</span>
<span class="s2">                     OR program ILIKE &#39;%Carnegie Mellon%&#39;</span>
<span class="s2">                     OR program ILIKE &#39;%CMU%&#39;</span>
<span class="s2">                  );</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Raw field accepted count&quot;</span>
            <span class="p">)</span>

            <span class="c1"># ----------------------------------------------------------</span>
            <span class="c1"># Custom Q10A: Top 5 programs (Fall 2026)</span>
            <span class="c1"># ----------------------------------------------------------</span>
            <span class="n">run_query</span><span class="p">(</span>
                <span class="n">cursor</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Custom Q10A: Top 5 Programs (Fall 2026)&quot;</span><span class="p">,</span>
                <span class="n">sql</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                SELECT program, COUNT(*)</span>
<span class="s2">                FROM applicants</span>
<span class="s2">                WHERE term = &#39;Fall 2026&#39;</span>
<span class="s2">                GROUP BY program</span>
<span class="s2">                ORDER BY COUNT(*) DESC</span>
<span class="s2">                LIMIT 5;</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">,</span>
                <span class="n">multi</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

            <span class="c1"># ----------------------------------------------------------</span>
            <span class="c1"># Custom Q10B: Avg GPA of international applicants</span>
            <span class="c1"># ----------------------------------------------------------</span>
            <span class="n">run_query</span><span class="p">(</span>
                <span class="n">cursor</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Custom Q10B: Avg GPA of International Applicants&quot;</span><span class="p">,</span>
                <span class="n">sql</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                SELECT ROUND(AVG(gpa)::numeric, 3)</span>
<span class="s2">                FROM applicants</span>
<span class="s2">                WHERE us_or_international = &#39;International&#39;</span>
<span class="s2">                  AND gpa IS NOT NULL;</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Average GPA International&quot;</span>
            <span class="p">)</span></div>



<span class="c1"># Standard s</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">GradCafe Analytics</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Documentation Sections</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview &amp; Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">Testing Guide</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2026, Sireesha Sankuratripati.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 9.1.0</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>